<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Chronicles Editor</title>
	<link rel="icon" type="image/png" href="./src/Images/UI/editor_icon.png" />
	<style>
		html{
      scroll-behavior: smooth;
		}

		body{
      background-size: 40px 40px;
      background-image:
              linear-gradient(to right, grey 1px, transparent 1px),
              linear-gradient(to bottom, grey 1px, transparent 1px);
			background-attachment: fixed;
		}

		button, a{
			border: 0;
			padding: 10px;
			margin: 0;
			cursor: pointer;
			border-radius: 15px;
			text-decoration: none;
			font-family: Arial;
			font-size: 15px;
		}

		button:disabled{
			color: #b2b2b2;
			cursor: no-drop;
		}

    button:disabled:hover{
      background-color: transparent;
    }

		label{
			margin: 5px 0 5px 0;
			padding: 0 0 2px 5px;
			border-bottom: 1px solid gray;
		}

		input{
			border: 0;
			border-radius: 15px;
			max-width: 250px;
			padding: 5px;
			background-color: #d9d9d9;
		}

		textarea{
      border: 1px solid #757575;
      border-radius: 15px;
			padding: 10px;
      box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
		}

		#uploadInput{
			display: none;
		}

    #scenarioToTransform{
      width: 250px;
			height: 250px;
		}

		.toolbar-menu{
			position: fixed;
			display: flex;
			flex-direction: row;
			justify-content: left;
			left: 0;
			right: 0;
			top: 0;
			background-color: gray;
			padding: 5px;
      box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
		}

		.toolbar-button{
			position: relative;
		}

    .toolbar-button:hover>.toolbar-category{
			opacity: 1;
			visibility: visible;
    }

		.toolbar-category-opener{
			display: flex;
			align-items: center;
			justify-content: center;
			text-align: center;
			margin: 0;
      border-radius: 15px;
			color: white;
			background-color: transparent;
		}

    .toolbar-category-opener:hover{
      background-color: rgba(0, 0, 0, 0.15);
    }

    .toolbar-category:hover{
      opacity: 1;
      visibility: visible;
    }

		.toolbar-category{
			position: absolute;
			top: 37px;
			left: 0;
			display: flex;
			flex-direction: column;
			visibility: hidden;
			opacity: 0;
      background-color: gray;
			padding: 5px;
			border-radius: 0 0 15px 15px;
			min-width: 200px;
      box-shadow: rgba(0, 0, 0, 0.25) 5px 10px 10px;
		}

		.toolbar-category-button{
			text-align: left;
      border-radius: 15px;
			background-color: transparent;
      color: white;
		}

    .toolbar-category-button:hover{
      background-color: rgba(0, 0, 0, 0.15);
    }

		.blueprint{
			padding: 50px 0;
		}

		.storyInfo{
			opacity: 0;
			visibility: hidden;
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			border-radius: 15px;
			padding: 10px;
			max-width: fit-content;
			gap: 10px;
		}

		.storyInfo-block{
			display: flex;
			flex-direction: column;
			background-color: white;
			border-radius: 15px;
			padding: 10px;
      box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
		}

		.slides{
			margin: 10px 0 0 0;
			gap: 10px;
			display: flex;
			flex-direction: column;
		}

		.slide{

		}

		.toTransformScenarioWindow{
			position: absolute;
			display: flex;
			opacity: 0;
			visibility: hidden;
			align-items: center;
			justify-content: center;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			background-color: rgba(0, 0, 0, 0.2);
			transition: all .5s ease-in-out;
		}

		.fullscreenWindow{
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.2);
      transition: all .5s ease-in-out;
		}

		.fullscreenBlock{
      display: flex;
			flex-direction: column;
      align-items: center;
			gap: 10px;
			padding: 10px;
      justify-content: center;
      background-color: white;
			border-radius: 15px;
			box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
		}

		.returnButton{
			position: fixed;
			right: 15px;
			bottom: 15px;
			border-radius: 50px;
			width: 50px;
			height: 50px;
			font-weight: 800;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 50px;
			background-color: white;
      box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
		}

    ::-webkit-scrollbar {
      width: 10px;
      height: 0;
			background-color: gray;
      box-shadow: rgba(0, 0, 0, 0.25) 0 0 15px;
    }

    ::-webkit-scrollbar-track {
      background: gray;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: white;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.8);
    }
	</style>
</head>
<body>
<div class="toolbar-menu">
	<div class="toolbar-button">
		<button class="toolbar-category-opener">–°—Ü–µ–Ω–∞—Ä–∏–π</button>
		<div class="toolbar-category">
			<button id="uploadButton" class="toolbar-category-button">–û—Ç–∫—Ä—ã—Ç—å</button>
			<button id="downloadButton" class="toolbar-category-button" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
			<button id="transformButton" class="toolbar-category-button">–ü–∞—Ä—Å–∏–Ω–≥</button>
		</div>
	</div>
	<div class="toolbar-button">
		<button class="toolbar-category-opener">–ü—Ä–∞–≤–∫–∞</button>
		<div class="toolbar-category">
			<button id="findSlideButton" class="toolbar-category-button" disabled>–ù–∞–π—Ç–∏ —Å–ª–∞–π–¥</button>
			<button id="replaceButton" class="toolbar-category-button" disabled>–ó–∞–º–µ–Ω–∏—Ç—å</button>
			<button id="addSlideButton" class="toolbar-category-button" disabled>–î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥</button>
		</div>
	</div>
	<div class="toolbar-button">
		<button class="toolbar-category-opener">–ò–Ω—Ñ–æ</button>
		<div class="toolbar-category">
			<a target='_blank' href="http://rtemiy.github.io/Chronicles_New/" class="toolbar-category-button">–ë–µ—Ç–∞</a>
			<a target='_blank' href="https://chroniclesgame.ru/" class="toolbar-category-button">–†–µ–ª–∏–∑</a>
			<a target='_blank' href="https://drive.google.com/drive/folders/1X2oIGak235my8hE5eavVWQDIENykHSSl?usp=drive_link" class="toolbar-category-button">–ì—É–≥–ª –¥–∏—Å–∫</a>
			<a target='_blank' href="https://t.me/RTemiy" class="toolbar-category-button">–°–æ–∑–¥–∞—Ç–µ–ª—å</a>
		</div>
	</div>
</div>

<div class="blueprint">
	<div class="storyInfo">
		<div class="storyInfo-block">
			<label for="storyCode">–ö–æ–¥ –∏—Å—Ç–æ—Ä–∏–∏</label><input id="storyCode" type="text">
		</div>
		<div class="storyInfo-block">
			<label for="chapterName">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã</label><input id="chapterName" type="text"></div>
		<div class="storyInfo-block">
			<label for="partName">–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏</label><input id="partName" type="text"></div>
		<div class="storyInfo-block">
			<label for="partCode">–ö–æ–¥ —á–∞—Å—Ç–∏</label><input id="partCode" type="text">
		</div>
		<div class="storyInfo-block">
			<label for="slidesAmount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–π–¥–æ–≤</label><input id="slidesAmount" disabled type="number">
		</div>
	</div>
	<div class="slides">
	</div>
</div>

<div id="replaceWindow" class="fullscreenWindow">
	<div class="fullscreenBlock">
		<label for="whatToReplace">–ó–∞–º–µ–Ω–∏—Ç—å:</label><input id="whatToReplace" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç" type="text">
		<label for="ToWhatToReplace">–ù–∞:</label><input id="ToWhatToReplace" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç" type="text">
		<button id="makeReplaceButton">–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å—ë</button>
	</div>
</div>

<div id="findWindow" class="fullscreenWindow">
	<div class="fullscreenBlock">
		<label for="slideNumberToFind">–ù–æ–º–µ—Ä —Å–ª–∞–π–¥–∞:</label><input id="slideNumberToFind" type="number">
		<button id="doFindButton">–ù–∞–π—Ç–∏</button>
	</div>
</div>

<a href="#" class="returnButton">üîù</a>

<div class="toTransformScenarioWindow">
	<textarea id="scenarioToTransform" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è"></textarea>
</div>

<input id="uploadInput" type="file">
<script>
	const uploadButton = document.querySelector('#uploadButton')
	const uploadInput = document.querySelector('#uploadInput')
	const downloadButton = document.querySelector('#downloadButton')
  const transformButton = document.querySelector('#transformButton')
  const addSlideButton = document.querySelector('#addSlideButton')
  const replaceButton = document.querySelector('#replaceButton')
  const makeReplaceButton = document.querySelector('#makeReplaceButton')
  const findSlideButton = document.querySelector('#findSlideButton')
  const doFindButton = document.querySelector('#doFindButton')

	const transformWindow = document.querySelector('.toTransformScenarioWindow')
  const replaceWindow = document.querySelector('#replaceWindow')
  const findWindow = document.querySelector('#findWindow')

	const storyInfo = document.querySelector('.storyInfo')
	const transformInput = document.querySelector('#scenarioToTransform')
  const slideNumberToFind = document.querySelector('#slideNumberToFind')
	const storyCode = document.querySelector('#storyCode')
  const chapterName = document.querySelector('#chapterName')
  const partName = document.querySelector('#partName')
  const partCode = document.querySelector('#partCode')
  const slidesAmount = document.querySelector('#slidesAmount')
	const whatToReplace = document.querySelector('#whatToReplace')
  const ToWhatToReplace = document.querySelector('#ToWhatToReplace')
	const slidesField = document.querySelector('.slides')

  const dictionary = new Map()

  let currentFile = ''

	addListeners()
	initDictionary()

	function addListeners() {
    uploadInput.onchange = () => {
      const FR = new FileReader()
      FR.readAsText(uploadInput.files[uploadInput.files.length-1])
      FR.onload = () => {
        currentFile = FR.result
				makeStructure()
        enableButtons()
      }
    }

    uploadButton.onclick = () => {
      uploadInput.click()
    }

    transformInput.onchange = () => {
      currentFile = makeScenario(prompt('–£–∫–∞–∂–∏—Ç–µ –∫–æ–¥ –∏—Å—Ç–æ—Ä–∏–∏'), transformInput.value)
			makeStructure()
      transformWindow.style.opacity = '0'
      transformWindow.style.visibility = 'hidden'
			enableButtons()
    }

    transformButton.onclick = () => {
      transformInput.value = ''
      transformWindow.style.opacity = '1'
			transformWindow.style.visibility = 'visible'
		}

    downloadButton.onclick = () => {
      saveFromEditor()
      saveFile(currentFile)
    }

    replaceButton.onclick = () => {
      whatToReplace.value = ''
      ToWhatToReplace.value = ''
      replaceWindow.style.opacity = '1'
      replaceWindow.style.visibility = 'visible'
		}

    makeReplaceButton.onclick = () => {
      const slides = document.querySelectorAll('.slide')
			slides.forEach(slide => {
        slide.value = slide.value.replaceAll(whatToReplace.value, ToWhatToReplace.value)
			})
      replaceWindow.style.opacity = '0'
      replaceWindow.style.visibility = 'hidden'
		}

    addSlideButton.onclick = () => {
      const newSlide = document.createElement('textarea')
			newSlide.value =
				`  {
    –ù–æ–º–µ—Ä —Å–ª–∞–π–¥–∞: –£–ö–ê–ñ–ò–¢–ï –ù–û–ú–ï–† –°–õ–ê–ô–î–ê,
    –¢–µ–∫—Å—Ç:
      \`
        –í–í–ï–î–ò–¢–ï –¢–ï–ö–°–¢ –°–õ–ê–ô–î–ê
      \`,
    –ö–Ω–æ–ø–∫–∏ —Å–ª–∞–π–¥–∞: [
      {
        –¢–µ–∫—Å—Ç: '',
        –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–∞–π–¥: –£–ö–ê–ñ–ò–¢–ï –ù–û–ú–ï–† –°–õ–ê–ô–î–ê –î–õ–Ø –ü–ï–†–ï–•–û–î–ê
      }],
    –§–æ–Ω: –£–ö–ê–ñ–ò–¢–ï –§–û–ù –°–õ–ê–ô–î–ê
  },

`
			newSlide.classList.add('slide')
      slidesField.appendChild(newSlide)
      newSlide.style.height = '5px'
      newSlide.style.height = newSlide.scrollHeight + 'px'
		}

    findSlideButton.onclick = () => {
      slideNumberToFind.value = ''
      findWindow.style.opacity = '1'
      findWindow.style.visibility = 'visible'
		}

    doFindButton.onclick = () => {
      findWindow.style.opacity = '0'
      findWindow.style.visibility = 'hidden'
      window.location.href = `#slide_${slideNumberToFind.value}`
		}
  }

  function saveFile(text) {
    const a = document.createElement('a')
    const file = new Blob([text], { type: 'application/text' })
    a.href = URL.createObjectURL(file)
    a.innerText = '–°–∫–∞—á–∞—Ç—å'
    a.download = `${prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞')}.ts`
    a.click()
  }

  function makeStructure () {
    const storyData = currentFile.match(/scenarioManager.addScenario\({ [\s\S]* }, \[/)[0].match(/{ [\s\S]* }/)[0]
    storyCode.value = storyData.match(/storyName: [\s\S]*, /)[0].split(': ')[1].split(',')[0]
    chapterName.value = storyData.match(/chapterName: [\s\S]*, /)[0].split(': ')[1].split(',')[0]
    partName.value = storyData.match(/partName: [\s\S]*, /)[0].split(': ')[1].split(',')[0]
    partCode.value = storyData.match(/code: [\s\S]* }/)[0].split(': ')[1].split('}')[0]
		let slides = currentFile.split('  {\n    id: ')
		slides.forEach((slide,index) => {
      slides[index] = '  {\n    id: ' + slides[index]
		})
    storyInfo.style.opacity = '1'
    storyInfo.style.visibility = 'visible'
		slides.shift()
    slidesField.innerHTML = ''
    let result = ''
    slidesAmount.value = '0'
    slides.forEach(slide => {
      for (const [key, value] of dictionary) {
        slide = slide.replaceAll(`${key}:`, `${value}:`)
      }

      result+=`
      <textarea id="slide_${parseInt(slidesAmount.value)}" class="slide">${slide}</textarea>
      `
      slidesField.innerHTML = result
      slidesAmount.value = parseInt(slidesAmount.value) + 1

      slidesField.querySelectorAll('.slide').forEach(slide => {
        slide.style.height = '5px'
				slide.style.height = slide.scrollHeight + 'px'

			})
    })
	}

  function saveFromEditor () {
    const fileBeginning = currentFile.split('scenarioManager.addScenario({')[0]
    let result = `${fileBeginning}scenarioManager.addScenario({ storyName: ${storyCode.value}, chapterName: ${chapterName.value}, partName: ${partName.value}, code: ${partCode.value}}, [\n`
		const slides = document.querySelectorAll('.slide')
		slides.forEach(slide => {
      for (const [key, value] of dictionary) {
        slide.value = slide.value.replaceAll(`${value}:`, `${key}:`)
      }
      result+=slide.value
		})

		currentFile = result
	}

  function enableButtons() {
    downloadButton.disabled = false
    addSlideButton.disabled = false
    replaceButton.disabled = false
    findSlideButton.disabled = false
  }

  function initDictionary() {
    dictionary.set('id', '–ù–æ–º–µ—Ä —Å–ª–∞–π–¥–∞')
    dictionary.set('text', '–¢–µ–∫—Å—Ç')
    dictionary.set('buttons', '–ö–Ω–æ–ø–∫–∏ —Å–ª–∞–π–¥–∞')
    dictionary.set('gift', '–í—ã–±–æ—Ä –∑–∞ —Ä–µ–∫–ª–∞–º—É')
    dictionary.set('goTo', '–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–∞–π–¥')
    dictionary.set('func', '–°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ')
    dictionary.set('speaker', '–†–µ–ø–ª–∏–∫–∞')
    dictionary.set('message', '–¢–∞–±–ª–∏—á–∫–∞')
    dictionary.set('music', '–ú—É–∑—ã–∫–∞')
    dictionary.set('ambient', '–≠–º–±–∏–µ–Ω—Ç')
    dictionary.set('beforeBegin', '–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–∞–π–¥–∞')
    dictionary.set('stats', '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—ã')
    dictionary.set('condition', '–£—Å–ª–æ–≤–∏–µ')
    dictionary.set('imageFront', '–û–±—ä–µ–∫—Ç')
    dictionary.set('imageBorder', '–†–∞–º–∫–∞')
    dictionary.set('imageBack', '–§–æ–Ω')
    dictionary.set('achievement', '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ')
  }

  function makeScenario(name, text){
    // –û–±—ä–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ —Å—Ü–µ–Ω–∞–º–∏
    const scenes = {};
    // –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–¥–∞ –æ–¥–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞
    const scenePrefab = '' +
      '\n  {' +
      '\n    id: $INDEX$,' +
      '\n    text: \n      `\n        $TEXT$\n      `, ' +
      '\n    buttons: [\n      {\n        text: \'\',\n        goTo: $INDEXPLUS$\n      }],' +
      '$MESSAGE$' +
      '$MUSIC$' +
      '$AMBIENT$' +
      '$SPEAKER$' +
      '$PICTUREFRONT$' +
      '$CUTSCENE$' +
      '$DARKS$' +
      '$GHOSTS$' +
      '\n    stats: [$STAT$$ITEM$$PERSON$],' +
      '\n    achievement: $ACHIEVEMENT$' +
      '\n    imageBack: require(\'../../../../Images/$NAME$/-$PICTURE$-\')' +
      '  \n  },'
    // –û—Ç–¥–µ–ª—è–µ–º –∫–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –µ—Å–ª–∏ –∫–æ–ª-–≤–æ –æ—Ç—Å—Ç—É–ø–æ–≤ 3+ –∏ –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü —Ä–∞–∑–¥–µ–ª—è–µ–º –ø—Ä–∏ –∫–æ–ª-–≤–µ –æ—Ç—Å—Ç—É–ø–æ–≤ 1
    scenes[name] = text.split(/\n\n\n+/g).map(slide => slide.split('\n'));
    // –°—ç—Ç—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
    const allPictures = new Set();
    const allMusic = new Set();
    const allItems = new Set();
    const allStats = new Set();
    const allPersons = new Set();
    const allAchievements = new Set();
    // –í—ã–≤–æ–¥–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    let result = ``;
    // –ö—ç—à–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É
    let picture = '';
    // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—Å–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–º —Å–ª–∞–π–¥–∞–º
    for(let x = 0; x<scenes[name].length;x++){
      // –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–≥–æ—Ç–æ–≤–∫—É –∫–æ–¥–∞ –æ–¥–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞
      let value = scenePrefab.slice();
      // –ü—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –≤—Å–µ–º –∞–±–∑–∞—Ü–∞–º –≤ —Å–ª–∞–π–¥–µ
      for(let y =0; y<scenes[name][x].length;y++){

        // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –¥–µ–ª–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
        if(/! –§–æ–Ω:* /.test(scenes[name][x][y])) {
          // –ó–∞–º–µ–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π
          scenes[name][x][y] = scenes[name][x][y].replace(/! –§–æ–Ω:* /, '');
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ —Å—ç—Ç
          allPictures.add(scenes[name][x][y]);
          // –í—ã—Ä–µ–∑–∞–µ–º –∏ –∫–µ—à–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
          picture = scenes[name][x].splice(y,1);
          // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º —à–∞–≥ –Ω–∞–∑–∞–¥ —Ç.–∫. –í–´–†–ï–ó–ê–õ–ò —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞
          y-=1;
        } else if (/! –û–±—ä–µ–∫—Ç:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –û–±—ä–µ–∫—Ç:* /, '');
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ —Å—ç—Ç
          allPictures.add(scenes[name][x][y]);
          // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
          value = value.replaceAll('$PICTUREFRONT$',`\n    imageFront: require('../../../../Images/$NAME$/-${scenes[name][x].splice(y,1)}-'),\n    imageBorder: require(\'../../../../Images/$NAME$/UI/Border.png\'),`);
          y-=1;
        } else if (/! –¢–∞–±–ª–∏—á–∫–∞:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –¢–∞–±–ª–∏—á–∫–∞:* /, '');
          // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
          value = value.replaceAll('$MESSAGE$',`\n    message: '${scenes[name][x].splice(y,1)}',`);
          y-=1;
        } else if (/! –†–µ–ø–ª–∏–∫–∞:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –†–µ–ø–ª–∏–∫–∞:* /, '');
          // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
          value = value.replaceAll('$SPEAKER$',`\n    speaker: '${scenes[name][x].splice(y,1)}',`);
          y-=1;
        } else if (/! –ö–∞—Ç-–°—Ü–µ–Ω–∞:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –ö–∞—Ç-–°—Ü–µ–Ω–∞:* /, '');
          // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
          value = value.replaceAll('$CUTSCENE$',`\n    cutScene: require('../../../../Images/$NAME$/-${scenes[name][x].splice(y,1)}-'),`);
          y-=1;
        } else if (/! –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ:* /, '');
          allAchievements.add(scenes[name][x][y]);
          // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ
          value = value.replaceAll('$ACHIEVEMENT$',`{ story: EStoriesEn.${name}, name: '${scenes[name][x].splice(y,1)}' },`);
          y-=1;
        } else if (/! –°–∏–ª—É—ç—Ç/.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –°–∏–ª—É—ç—Ç/, '');
          value = value.replaceAll('$DARKS$',`darkSilhouette: true,`);
          scenes[name][x].splice(y,1)
          y-=1;
        } else if (/! –ü—Ä–∏–∑—Ä–∞–∫/.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –ü—Ä–∏–∑—Ä–∞–∫/, '');
          value = value.replaceAll('$GHOSTS$',`ghostSilhouette: true,`);
          scenes[name][x].splice(y,1)
          y-=1;
        } else if (/! –ú—É–∑—ã–∫–∞:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –ú—É–∑—ã–∫–∞:* /, '');
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ –≤ —Å—ç—Ç
          allMusic.add(scenes[name][x][y]);
          value = value.replaceAll('$MUSIC$',`\n    music: require('../../../../Sounds/${name}/=${scenes[name][x].splice(y,1)}='),`);
          y-=1;
        } else if (/! –≠–º–±–∏–µ–Ω—Ç:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –≠–º–±–∏–µ–Ω—Ç:* /, '');
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ –≤ —Å—ç—Ç
          allMusic.add(scenes[name][x][y]);
          value = value.replaceAll('$AMBIENT$',`\n    ambient: require('../../../../Sounds/${name}/=${scenes[name][x].splice(y,1)}='),`);
          y-=1;
        }
        else if (/! –ü—Ä–µ–¥–º–µ—Ç:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –ü—Ä–µ–¥–º–µ—Ç:* /, '');
          let word = scenes[name][x][y].split(' ');
          const itemAmount = word.pop();
          word = word.join(' ');
          allItems.add(word);
          scenes[name][x][y] = '';
          value = value.replaceAll('$ITEM$',`\n          { story: EStoriesEn.${name}, value: ${itemAmount}, category: 'Item', id: '&${word}&' },$ITEM$`);
          y-=1;
        } else if (/! –°—Ç–∞—Ç:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –°—Ç–∞—Ç:* /, '');
          let word = scenes[name][x][y].split(' ');
          const statAmount = word.pop();
          word = word.join(' ');
          allStats.add(word);
          scenes[name][x][y] = '';
          value = value.replaceAll('$STAT$',`\n          { story: EStoriesEn.${name}, value: ${statAmount}, category: 'Effect', id: '*${word}*' },$STAT$`);
          y-=1;
        }
        else if (/! –ü–µ—Ä—Å–æ–Ω–∞–∂:* /.test(scenes[name][x][y])) {
          scenes[name][x][y] = scenes[name][x][y].replace(/! –ü–µ—Ä—Å–æ–Ω–∞–∂:* /, '');
          let word = scenes[name][x][y].split(' ');
          const statAmount = word.pop();
          word = word.join(' ');
          allPersons.add(word);
          scenes[name][x][y] = '';
          value = value.replaceAll('$PERSON$',`\n          { story: EStoriesEn.${name}, value: ${statAmount}, category: 'Person', id: '*${word}*' },$STAT$`);
          y-=1;
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ –∞–±–∑–∞—Ü–∞
        else if(scenes[name][x][y]===''){
          scenes[name][x].splice(y,1);
          y-=1;
        }
      }
      // –°–æ–µ–¥–∏–Ω—è–µ–º –∞–±–∑–∞—Ü—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ <p>
      scenes[name][x] = scenes[name][x].join('<p>');
      // –£–¥–∞–ª—è–µ–º <p> –≤ –Ω–∞—á–∞–ª–µ
      if (scenes[name][x].startsWith('<p>')) scenes[name][x] = scenes[name][x].replace('<p>', '');
      // –ó–∞–º–µ–Ω—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è
      value = value.replaceAll('$NAME$',name);
      value = value.replaceAll('$PICTURE$', picture);
      value = value.replaceAll('$INDEX$', x + '');
      value = value.replaceAll('$INDEXPLUS$', x + 1 + '');
      value = value.replaceAll('$TEXT$', `${scenes[name][x]}`);
      // –£–¥–∞–ª—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å
      value = value.replaceAll('$ITEM$','');
      value = value.replaceAll('$STAT$','');
      value = value.replaceAll('$PERSON$','');
      value = value.replaceAll('$MESSAGE$','');
      value = value.replaceAll('$MUSIC$','');
      value = value.replaceAll('$AMBIENT$','');
      value = value.replaceAll('$SPEAKER$','');
      value = value.replaceAll('$CUTSCENE$','');
      value = value.replaceAll('$PICTUREFRONT$','');
      value = value.replaceAll('$DARKS$','');
      value = value.replaceAll('$GHOSTS$','');
      value = value.replaceAll('\n    stats: [],','');
      value = value.replaceAll('\n    achievement: $ACHIEVEMENT$','');
      value = value.replaceAll('\n    doBeforeBegin: () => {\n      },','');
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥ —Å–ª–∞–π–¥–∞ –≤ —Å—Ç—Ä–æ–∫—É
      result += value + '\n';
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏ –º—É–∑—ã–∫–∏ –≤ –Ω–∞—á–∞–ª–æ –∫–æ–¥–∞ –≤—Å–µ—Ö —Å–ª–∞–π–¥–æ–≤ (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ª–∏ –∑–∞–º–µ–Ω–∏–ª–æ—Å—å)
    const initConst = 'scenarioManager.addScenario({ ' +
      'storyName: EStoriesEn.'  + prompt('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º') +
      ', chapterName: \'' + prompt('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã') +
      '\', partName: \'' + prompt('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏') +
      '\', code: \'' + prompt('–£–∫–∞–∂–∏—Ç–µ –∫–æ–¥ —á–∞—Å—Ç–∏') +'\' }, [';
    const resultImages = '// –ö–∞—Ä—Ç–∏–Ω–∫–∏: ' + JSON.stringify([...allPictures]) + '\n\n';
    const resultMusic = '// –ú—É–∑—ã–∫–∞:' + JSON.stringify([...allMusic]) + '\n\n';
    const resultItems = '// –ü—Ä–µ–¥–º–µ—Ç—ã:' + JSON.stringify([...allItems]) + '\n\n';
    const resultStats = '// –°—Ç–∞—Ç—ã:' + JSON.stringify([...allStats]) + '\n\n';
    const resultPersons = '// –ü–µ—Ä—Å–æ–Ω–∞–∂–∏:' + JSON.stringify([...allPersons]) + '\n\n';
    const resultAchievements = '// –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:' + JSON.stringify([...allAchievements]) + '\n\n';

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–º–µ–Ω—ã —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞—Ä—Ç–∏–Ω–æ–∫, –º—É–∑—ã–∫–∏ –∏ —Ç–¥ –Ω–∞ –ø—É—Ç–∏ –¥–æ —Ñ–∞–π–ª–æ–≤
    function setCodeNames(set, message, brackets = '', additional = '') {
      set.forEach(element => result = result.replaceAll(`${brackets}${element}${brackets}`,  prompt(`${message} [ ${element} ] :`) + additional));
    }

    setCodeNames(allPictures, '–£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –¥–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è', '-');
    setCodeNames(allMusic, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ –¥–ª—è', '=', '.mp3');
    setCodeNames(allItems, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è', '&');
    setCodeNames(allStats, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∞ –¥–ª—è', '*');
    setCodeNames(allPersons, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è', '*');
    setCodeNames(allAchievements, '–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –¥–ª—è');

    result = resultImages + resultMusic + resultPersons + resultItems + resultStats + resultAchievements + initConst + result + '])\n';
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    return result;
  }

</script>
</body>
</html>